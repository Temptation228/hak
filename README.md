## Система финансового мониторинга и отчетности

### Быстрый старт
1. Создайте директорию проекта, например, `personal-finance`
2. Перейдите в директорию проекта в консоли и скопируйте репозиторий проекта в директорию проекта: выполните команду `git clone git@github.com:borisey/financial-monitoring-and-reporting ./`
3. Установите зависимости `Maven`. В консоли (в корневой директории проекта) выполните команду `mvn clean install`
4. Установите `MySQL` в `Docker-контейнере`: в консоли (в корневой директории проекта) выполните команду `docker-compose up`
5. Запустите приложение в IDE IDEA: откройте файл `/src/main/java/com/borisey/personal_finance/PersonalFinanceApplication.java` и выполните команду `RUN`
6. Откройте приложение в браузере `http://localhost:8080`
7. Зарегистрируйтесь в приложении (по ссылке: `http://localhost:8080/register`)
8. Авторизуйтесь в приложении, используя логин и пароль, указанные при регистрации
9. Создайте `категорию дохода`
10. Создайте `категорию расхода`
12. Добавьте `транзакции` 
13. Сформируйте отчеты

### Описание приложения
1. Реализация авторизации пользователей
2. Взаимодействие с пользователем
3. Управление доходами и расходами
4. Вывод информации
5. Сохранение и загрузка данных
6. Валидация данных
7. Дополнительные возможности
8. Генерация отчетов
9. Вывод аналитики по разным параметрам
10. Разделение функционала по классам


## Итоговые артефакты демонстрации реализованного решения

## Реализованное веб-приложение

Приложение реализовано


## Демонстрация работы с входными данными

https://drive.google.com/file/d/1ZWWb_chqjkZ3K1CxNxZI6V2guAqh2zhq/view


## Отчеты о прохождении тестирования

https://drive.google.com/file/d/1ZWWb_chqjkZ3K1CxNxZI6V2guAqh2zhq/view


## Архитектура

Многослойная архитектура (n-tier architecture) основанная на принципах Model-View-Controller (MVC) с элементами REST

![image](https://github.com/user-attachments/assets/0134b001-832d-4790-9888-03ca6d913055)

### Слои приложения

#### 1 Уровень представления (Presentation Layer)
Контроллеры `com.borisey.personal_finance.controllers`:
Обрабатывают HTTP-запросы
REST API эндпоинты для взаимодействия с фронтендом
Контроллеры: `BankController`, `CategoryController`, `ReferenceDataController`, `ReportController`, `TransactionController`

#### 2 Уровень бизнес-логики (Business Layer)
Сервисы `com.borisey.personal_finance.services`:
Реализуют бизнес-логику приложения
Обрабатывают данные, полученные от контроллеров
Взаимодействуют с репозиториями для получения/сохранения данных
`UserService` для аутентификации и управления пользователями

#### 3 Уровень доступа к данным (Data Access Layer)
Репозитории `com.borisey.personal_finance.repo`:
Интерфейсы, расширяющие Spring Data JPA для доступа к базе данных
Репозитории: `UserRepository`, `BankRepository`, `CategoryRepository`, `PersonTypeRepository`, `TransactionRepository`, `TransactionStatusRepository`, `TransactionTypeRepository`
Спецификации `com.borisey.personal_finance.specifications`:
Реализуют гибкую фильтрацию данных в запросах к БД

#### 4 Уровень данных (Data Layer)
Модели `com.borisey.personal_finance.models`:
Сущности JPA: `Bank`, `Category`, `PersonType`, `Transaction`, `TransactionStatus`, `TransactionType`, `User`
Соответствуют таблицам базы данных
Содержат связи между сущностями
Аннотированы для корректного ORM-мапинга

#### 5 Конфигурация и безопасность
Конфигурационные классы `com.borisey.personal_finance.config`:
`WebSecurityConfig` для настройки аутентификации и авторизации
Настройка CORS для взаимодействия с фронтендом

### Диаграмма компонентов системы

![image](https://github.com/user-attachments/assets/6b2433ff-d6fa-4506-b0b3-bfbd0ddc5df4)

### Технологический стек

#### Backend:
Java 23
Spring Boot 3.3.5
Spring Security (аутентификация/авторизация)
Spring Data JPA (доступ к данным)
Hibernate (ORM)

#### Хранение данных:
MySQL (база данных)
Hibernate Validator (валидация данных)

#### Дополнительные библиотеки:
Lombok (уменьшение шаблонного кода)
Apache POI (работа с Excel файлами для отчетов)
Joda Time (работа с датами)
Apache Commons Lang (утилиты)

#### Инфраструктура:
Docker (контейнеризация)
Maven (сборка проекта)


## Диаграммы (бд, пользовательские)

![image](https://github.com/user-attachments/assets/68ded25f-84e8-4e5f-81f7-f3e3802c911a)

## Техническая документация

Все пути начинаются с `auth/` для общения с сервером после логина необходимо добовлять Cookie `SESSIONID` к каждому запросу.  

## API Endpoints: Authentication Controller

Этот контроллер предоставляет endpoints для аутентификации пользователей (вход, регистрация, выход).

### 1. Login (Вход)

*   **Method:** `POST`
*   **URL:** `/api/auth/login`
*   **Description:** Аутентификация существующего пользователя.

#### Заголовки 

*   `Content-Type`: `application/json` 

#### Тело запроса 

```json
{
  "username": "user123",  
  "password": "password123" 
}
```

### 2. register (Регистрация)

*   **Method:** `POST`
*   **URL:** `/api/auth/register`
*   **Description:** Регистрация нового пользователя.

#### Заголовки 

*   `Content-Type`: `application/json` 

#### Тело запроса 

```json
{
  "username": "user123",  
  "password": "password123" 
```

### 3. register (Logout)

*   **Method:** `POST`
*   **URL:** `/api/auth/logout`
*   **Description:** Выход.

#### Заголовки (Headers)

*   `Content-Type`: `application/json` 

## 4. Get Current User (Получение информации о текущем пользователе)

Получение информации о текущем аутентифицированном пользователе.

*   **Метод:** `GET`
*   **URL:** `/api/auth/user`

### Заголовки 

`Content-Type`: `application/json` 

### Тело запроса 

*   Тело запроса не требуется.


## API Endpoints: Category Controller

Этот контроллер предоставляет endpoints для управления категориями транзакций. Доступен только пользователям с ролью 'USER'.

**Базовый URL:** `/api/categories`

### Аутентификация

Все endpoints требуют аутентификации пользователя с ролью `USER`. Это можно сделать через активную сессию.

### 1. Get All Categories (Получение всех категорий)

Получение списка всех категорий, принадлежащих текущему пользователю.

*   **Метод:** `GET`
*   **URL:** `/api/categories`

### Заголовки 

| Заголовок      | Значение                   | Описание                                                                                               |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         |                                |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации.                           |

#### Параметры запроса (Query Parameters)

| `transactionTypeId` | `integer` | (Опционально) ID типа транзакции, для фильтрации категорий по типу транзакции.                                   
| `sortBy`            | `string`  | (Опционально) Поле, по которому нужно отсортировать категории.                                                     

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

```json
[
  {
    "id": 1,
    "title": "Продукты",
    "transactionTypeId": 1,
    "userId": 1
  },
  {
    "id": 2,
    "title": "Транспорт",
    "transactionTypeId": 2,
    "userId": 1
  }
]
```

### 2. Get Category By ID (Получение категории по ID)

Получение информации о конкретной категории по её уникальному идентификатору.

*   **Метод:** `GET`
*   **URL:** `/api/categories/{id}`

#### Параметры URL (Path Parameters)


 `id` | `integer` | **Обязательный**. Уникальный идентификатор категории, информацию о которой необходимо получить.  Значение должно быть целым числом, представляющим существующую категорию, принадлежащую текущему пользователю. 

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                               |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         |                                     |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации.                           |

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает объект категории в формате JSON.

```json
{
  "id": 123,
  "title": "Еда",
  "transactionTypeId": 456,
  "userId": 789
}
```

### 3. Get Categories With Totals (Получение категорий с суммами транзакций)

Получение списка категорий с общей суммой транзакций за указанный период времени для определенного типа транзакций.

*   **Метод:** `GET`
*   **URL:** `/api/categories/with-totals`

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                               |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         |                                      |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации.                           |

#### Параметры запроса (Query Parameters)

| Параметр        | Тип         | Описание                                                                                                                                                                                                                                                                                                                             | Обязательный | Значение по умолчанию | Формат                                 |
|-----------------|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|-----------------------|----------------------------------------|
| `transactionTypeId` | `integer`   | **Обязательный**. Идентификатор типа транзакции, для которого нужно получить итоги по категориям.                                                                                                                                                                                                                                           | Да           | N/A                     | Целое число                              |
| `startDate`     | `string`    | (Необязательный) Начальная дата периода, за который нужно получить итоги.                                                                                                                                                                                                                                                                | Нет          | 1 месяц назад от текущей даты (включительно) | `dd.MM.yyyy` (например, `01.01.2023`) |
| `endDate`       | `string`    | (Необязательный) Конечная дата периода, за который нужно получить итоги.                                                                                                                                                                                                                                                                 | Нет          | Текущая дата (включительно)                | `dd.MM.yyyy` (например, `31.12.2023`) |
| `sortBy`        | `string`    | (Необязательный)  Поле, по которому нужно отсортировать категории.                                                                                                                                                                                                                                                                       | Нет          | `title`                | Строка (например, `title`)              |

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, где ключи - это названия категорий, а значения - общие суммы транзакций для каждой категории за указанный период и для указанного типа транзакций.

```json
{
  "Продукты": 1250.50,
  "Транспорт": 300.00,
  "Развлечения": 500.00
}
```

### 4. Create Category (Создание категории)

Создание новой категории для текущего аутентифицированного пользователя.

*   **Метод:** `POST`
*   **URL:** `/api/categories`

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                               |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         | **Обязательный**. Указывает, что тело запроса содержит JSON-объект.                                      |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации.                           |

#### Тело запроса (Request Body)

Тело запроса должно содержать JSON-объект, представляющий новую категорию.

```json
{
  "title": "Новая категория",
  "transactionTypeId": 1
}
```

### 5. Update Category (Обновление категории)

Обновление информации о существующей категории по её ID.

*   **Метод:** `PUT`
*   **URL:** `/api/categories/{id}`

#### Параметры URL (Path Parameters)

| Параметр | Тип      | Описание                                                                                                                              |
|----------|----------|---------------------------------------------------------------------------------------------------------------------------------------|
| `id`     | `integer` | **Обязательный**. Уникальный идентификатор категории, которую необходимо обновить.                                                     |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                       |
|-----------------|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         | **Обязательный**. Указывает, что тело запроса содержит JSON-объект.                                                                            |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Без этого невозможно определить, кому принадлежит категория и есть ли права на её изменение. |

#### Тело запроса (Request Body)

Тело запроса должно содержать JSON-объект с информацией для обновления категории. 

```json
{
  "title": "Новое название категории",
  "budget": 1000.00,
  "transactionTypeId": 2
}
```

### 6. Delete Category (Удаление категории)

Удаление существующей категории по её ID.

*   **Метод:** `DELETE`
*   **URL:** `/api/categories/{id}`

#### Параметры URL (Path Parameters)

| Параметр | Тип      | Описание                                                                                                                               |
|----------|----------|----------------------------------------------------------------------------------------------------------------------------------------|
| `id`     | `integer` | **Обязательный**. Уникальный идентификатор категории, которую необходимо удалить.                                                        |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                           |
|-----------------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для проверки прав на удаление категории. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `text/plain`

При успешном удалении сервер возвращает сообщение об успехе.

```text
Категория успешно удалена
```

### 7. Search Categories (Поиск категорий)

Поиск категорий по частичному совпадению в названии.

*   **Метод:** `GET`
*   **URL:** `/api/categories/search`

#### Параметры запроса (Query Parameters)

| Параметр | Тип     | Описание                                                                                                              | Обязательный |
|----------|---------|-----------------------------------------------------------------------------------------------------------------------|--------------|
| `term`   | `string` | **Обязательный**. Строка для поиска в названии категорий.  Будут возвращены категории, в названии которых содержится эта строка (регистронезависимо). | Да           |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                       |
|-----------------|----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для проверки прав доступа к категориям. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает список категорий, соответствующих поисковому запросу, в формате JSON. Если ничего не найдено, возвращается пустой список.

```json
[
  {
    "id": 1,
    "title": "Продукты питания",
    "transactionTypeId": 1,
    "userId": 1
  },
  {
    "id": 3,
    "title": "Продукты для дома",
    "transactionTypeId": 3,
    "userId": 1
  }
]
```

## API Endpoints: Reference Data Controller

Этот контроллер предоставляет эндпоинт для получения справочных данных. Доступен только пользователям с ролью 'USER'.

**Базовый URL:** `/api/reference`

### Аутентификация

Все запросы требуют аутентификации пользователя с ролью `USER`. Это обеспечивается через передачу Cookie `SESSIONID` в заголовке запроса.

### 1. Get All Reference Data (Получение всех справочных данных)

Получение всех справочных данных, включая типы лиц, типы транзакций и статусы транзакций.

*   **Метод:** `GET`
*   **URL:** `/api/reference/all`

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                |
|-----------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для доступа к справочным данным. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий все справочные данные.

```json
{
  "personTypes": [
    {
      "id": 1,
      "name": "Физическое лицо"
    },
    {
      "id": 2,
      "name": "Юридическое лицо"
    }
  ],
  "transactionTypes": [
    {
      "id": 1,
      "name": "INCOME"
    },
    {
      "id": 2,
      "name": "EXPENSE"
    }
    {
      "id": 3,
      "name": "TRANSFER"
    }
  ],
  "transactionStatuses": [
    {
      "id": 1,
      "name": "Новая"
    },
    {
      "id": 2,
      "name": "Подтвержденная"
    },
    {
      "id": 3,
      "name": "В обработке"
    },
    {
      "id": 4,
      "name": "Отменена"
    },
    {
      "id": 5,
      "name": "Платеж выполнен"
    },
    {
      "id": 6,
      "name": "Платеж удален"
    },
    {
      "id": 7,
      "name": "Возврат"
    }
  ]
}
```
так же есть отдельные для каждого типа данных

`/person-types` , `/transaction-types`, `/transaction-statuses`


## API Endpoints: Bank Controller

Этот контроллер предоставляет эндпоинт для получения списка банков. Доступен только пользователям с ролью `USER`.

**Базовый URL:** `/api/banks`

### Аутентификация

Все запросы требуют аутентификации пользователя с ролью `USER`. Это обеспечивается путем передачи Cookie `SESSIONID` в заголовке запроса.

### Get All Banks (Получение списка банков)

Получение списка всех банков, доступных в системе.

*   **Метод:** `GET`
*   **URL:** `/api/banks`

#### Параметры запроса (Query Parameters)

| Параметр | Тип     | Описание                                                                                                     | Обязательный | Значение по умолчанию |
|----------|---------|--------------------------------------------------------------------------------------------------------------|--------------|-------------------------|
| `sortBy` | `string` | (Необязательный) Поле, по которому необходимо отсортировать список банков.                                    | Нет          | `title`                   |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                               |
|-----------------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Без этого доступ к данным невозможен. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает список банков в формате JSON.

## API Endpoints: Transaction Controller

Этот контроллер предоставляет endpoint для получения списка транзакций с поддержкой фильтрации, пагинации и сортировки. Доступен только пользователям с ролью `USER`.

**Базовый URL:** `/api/transactions`

### Аутентификация

Все запросы требуют аутентификации пользователя с ролью `USER`.  Необходимо передать Cookie `SESSIONID` в заголовке запроса.

### 1. Get All Transactions (Получение списка транзакций)

Получение списка транзакций с возможностью фильтрации по различным параметрам, пагинацией и сортировкой.

*   **Метод:** `GET`
*   **URL:** `/api/transactions`

#### Параметры запроса (Query Parameters)

| Параметр           | Тип       | Описание                                                                                                                                  | Обязательный | Значение по умолчанию | Формат                 |
|--------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|------------------------|
| `senderBankId`     | `integer` | (Необязательный) ID банка отправителя.                                                                                                      | Нет          | N/A                     | Целое число           |
| `recipientBankId`  | `integer` | (Необязательный) ID банка получателя.                                                                                                      | Нет          | N/A                     | Целое число           |
| `startDate`        | `string`  | (Необязательный) Начальная дата периода транзакций.                                                                                          | Нет          | N/A                     | `dd.MM.yyyy`           |
| `endDate`          | `string`  | (Необязательный) Конечная дата периода транзакций.                                                                                           | Нет          | N/A                     | `dd.MM.yyyy`           |
| `statusId`         | `integer` | (Необязательный) ID статуса транзакции.                                                                                                    | Нет          | N/A                     | Целое число           |
| `inn`              | `string`  | (Необязательный) ИНН получателя.                                                                                                           | Нет          | N/A                     | Строка                |
| `minAmount`        | `number`  | (Необязательный) Минимальная сумма транзакции.                                                                                                | Нет          | N/A                     | Число с плавающей точкой |
| `maxAmount`        | `number`  | (Необязательный) Максимальная сумма транзакции.                                                                                                | Нет          | N/A                     | Число с плавающей точкой |
| `transactionTypeId`| `integer` | (Необязательный) ID типа транзакции.                                                                                                       | Нет          | N/A                     | Целое число           |
| `categoryId`       | `integer` | (Необязательный) ID категории транзакции.                                                                                                    | Нет          | N/A                     | Целое число           |
| `page`             | `integer` | (Необязательный) Номер страницы (начинается с 0).                                                                                           | Нет          | `0`                     | Целое число           |
| `size`             | `integer` | (Необязательный) Количество транзакций на странице.                                                                                             | Нет          | `10`                    | Целое число           |
| `sortBy`           | `string`  | (Необязательный) Поле для сортировки.                                                                                                      | Нет          | `operationDateTime`      | Строка                |
| `sortDir`          | `string`  | (Необязательный) Направление сортировки (`asc` или `desc`).                                                                                | Нет          | `desc`                  | Строка (`asc` или `desc`)  |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                         |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для доступа к транзакциям пользователя. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект с информацией о транзакциях, текущей странице, общем количестве элементов и общем количестве страниц.

```json
{
  "transactions": [
    {
      "id": 1,
      "operationDateTime": "2024-01-15T12:00:00",
      "amount": 100.00,
      "senderBankId": 1,
      "recipientBankId": 2,
      "statusId": 1,
      "inn": "1234567890",
      "transactionTypeId": 1,
      "categoryId": 1,
      "userId": 1
    },
    {
      "id": 2,
      "operationDateTime": "2024-02-20T15:30:00",
      "amount": 50.00,
      "senderBankId": 2,
      "recipientBankId": 1,
      "statusId": 2,
      "inn": "0987654321",
      "transactionTypeId": 2,
      "categoryId": 2,
      "userId": 1
    }
  ],
  "currentPage": 0,
  "totalItems": 25,
  "totalPages": 3
}
```

### 2. Get Transaction By ID (Получение транзакции по ID)

Получение информации о конкретной транзакции по её уникальному идентификатору.

*   **Метод:** `GET`
*   **URL:** `/api/transactions/{id}`

#### Параметры URL (Path Parameters)

| Параметр | Тип     | Описание                                                                                                                                                                                                                                                                                                                         |
|----------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `id`     | `integer` | **Обязательный**. Уникальный идентификатор транзакции, информацию о которой необходимо получить. Значение должно быть целым числом, представляющим существующую, *не удаленную* транзакцию, принадлежащую текущему пользователю.                                                                                                  |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                                                                                    |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для проверки прав доступа к транзакции.                                                                                                                                          |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает объект транзакции в формате JSON.

```json
{
  "id": 123,
  "operationDateTime": "2024-01-15T12:00:00",
  "amount": 100.00,
  "senderBankId": 1,
  "recipientBankId": 2,
  "statusId": 1,
  "inn": "1234567890",
  "transactionTypeId": 1,
  "categoryId": 1,
  "userId": 1
}
```

### 3. Create Transaction (Создание транзакции)

Создание новой транзакции для текущего аутентифицированного пользователя.

*   **Метод:** `POST`
*   **URL:** `/api/transactions`

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                   |
|-----------------|----------------------------|------------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         | **Обязательный**. Указывает, что тело запроса содержит JSON-объект.                                        |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**.  Содержит идентификатор сессии пользователя для аутентификации и авторизации.           |

#### Тело запроса (Request Body)

Тело запроса должно содержать JSON-объект, представляющий новую транзакцию. Обратите внимание, что некоторые поля (например, `id`, `userId`, `created`, `updated`, `status`) будут установлены сервером автоматически.

```json
{
  "operationDateTime": "2024-11-15T10:00:00",
  "amount": 50.00,
  "senderBankId": 1,
  "recipientBankId": 2,
  "inn": "1234567890",
  "transactionTypeId": 1,
  "categoryId": 1
}
```


### 4. Update Transaction (Обновление транзакции)

Обновление информации о существующей транзакции по её ID.

*   **Метод:** `PUT`
*   **URL:** `/api/transactions/{id}`

#### Параметры URL (Path Parameters)

| Параметр | Тип      | Описание                                                                                             |
|----------|----------|------------------------------------------------------------------------------------------------------|
| `id`     | `integer` | **Обязательный**. Уникальный идентификатор транзакции, которую необходимо обновить.               |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                             |
|-----------------|----------------------------|---------------------------------------------------------------------------------------------------------|
| `Content-Type` | `application/json`         | **Обязательный**. Указывает, что тело запроса содержит JSON-объект.                                    |
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации.          |

#### Тело запроса (Request Body)

Тело запроса должно содержать JSON-объект с информацией для обновления транзакции. Важно: все поля транзакции, которые вы хотите сохранить, должны быть включены в тело запроса, так как отсутствующие поля будут перезаписаны значениями по умолчанию или `null` (в зависимости от типа поля).

```json
{
  "personType": {
    "id": 1,
    "name": "Физическое лицо"
  },
  "operationDateTime": "2024-11-16T12:00:00",
  "comment": "Обновленное описание",
  "amount": 75.00,
  "status": {
    "id": 2,
    "code": "PENDING",
    "name": "В ожидании"
  },
  "senderBank": {
    "id": 3,
    "title": "Альфа-Банк"
  },
  "recipientBank": {
    "id": 4,
    "title": "ВТБ"
  },
  "recipientInn": "9876543210",
  "category": {
    "id": 5,
    "title": "Развлечения",
    "transactionTypeId": 2,
    "userId": 1
  },
  "recipientPhone": "79991234567"
}
```

### 5. Delete Transaction (Удаление транзакции)

Пометка существующей транзакции как удаленной.  Фактически, транзакция не удаляется из базы данных, а изменяется её статус на "DELETED".

*   **Метод:** `DELETE`
*   **URL:** `/api/transactions/{id}`

#### Параметры URL (Path Parameters)

| Параметр | Тип      | Описание                                                                                                                                       |
|----------|----------|------------------------------------------------------------------------------------------------------------------------------------------------|
| `id`     | `integer` | **Обязательный**. Уникальный идентификатор транзакции, которую необходимо пометить как удаленную.                                                    |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                   |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации.  Необходим для проверки прав на удаление транзакции. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `text/plain`

При успешном выполнении запроса сервер возвращает сообщение об успехе.

```text
Транзакция помечена как удаленная
```

### 6. Get Transaction Count By Period (Получение статистики по количеству транзакций за период)

Получение количества транзакций за указанный период времени.

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/count-by-period`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                                                                                                                                                                         | Обязательный | Значение по умолчанию | Формат              |
|------------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|----------------------|
| `period`   | `string` | **Обязательный**.  Период времени, за который необходимо получить статистику. Допустимые значения: `week`, `month`, `quarter`, `year`.  Регистр не имеет значения.                                                                                                                                           | Да           | N/A                     | Строка (`week`, `month`, `quarter`, `year`) |
| `baseDate` | `string` | (Необязательный) Базовая дата, относительно которой будет рассчитываться период. Если не указана, используется текущая дата.                                                                                                                                                                            | Нет          | Текущая дата              | `dd.MM.yyyy`         |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                                                 |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики по транзакциям пользователя. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий период и количество транзакций за этот период.

```json
{
  "period": "month",
  "count": 15
}
```

### 7. Get Amount By Transaction Type (Получение статистики по суммам транзакций по типу)

Получение общей суммы транзакций за указанный период времени для определенного типа транзакций.

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/amount-by-type`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                                                                                                 | Обязательный | Значение по умолчанию | Формат              |
|------------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|----------------------|
| `typeCode` | `string` | **Обязательный**. Код типа транзакции, для которого необходимо получить статистику.  Например, "INCOME" или "EXPENSE". Регистр не имеет значения (сервер преобразует в верхний).                                         | Да           | N/A                     | Строка               |
| `startDate` | `string` | (Необязательный) Начальная дата периода, за который нужно получить статистику. Если не указана, используется дата за месяц до текущей.                                                                               | Нет          | 1 месяц назад           | `dd.MM.yyyy`         |
| `endDate`   | `string` | (Необязательный) Конечная дата периода, за который нужно получить статистику. Если не указана, используется текущая дата.                                                                                               | Нет          | Текущая дата              | `dd.MM.yyyy`         |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                                     |
|-----------------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики по суммам транзакций. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий код типа транзакции и общую сумму транзакций этого типа за указанный период. Если транзакций данного типа не найдено, `totalAmount` будет равен 0.

```json
{
  "typeCode": "INCOME",
  "totalAmount": 1500.50
}
```

### 8. Get Income vs Expense (Получение статистики "доходы против расходов")

Получение общей суммы доходов и расходов за указанный период, а также расчет баланса (доходы минус расходы).

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/income-vs-expense`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                                                                               | Обязательный | Значение по умолчанию | Формат              |
|------------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|----------------------|
| `startDate` | `string` | (Необязательный) Начальная дата периода, за который нужно получить статистику. Если не указана, используется дата за месяц до текущей.                                                                | Нет          | 1 месяц назад           | `dd.MM.yyyy`         |
| `endDate`   | `string` | (Необязательный) Конечная дата периода, за который нужно получить статистику. Если не указана, используется текущая дата.                                                                                 | Нет          | Текущая дата              | `dd.MM.yyyy`         |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                                       |
|-----------------|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики о доходах и расходах. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий общую сумму доходов, общую сумму расходов и баланс за указанный период.

```json
{
  "totalIncome": 2500.00,
  "totalExpense": 1000.00,
  "balance": 1500.00
}
```

### 9. Get Transaction Count By Status (Получение количества транзакций по статусам)

Получение количества транзакций для каждого статуса транзакции.

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/count-by-status`

#### Параметры запроса (Query Parameters)

*   Нет (Query parameters не требуются).

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                            |
|-----------------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий количество транзакций для каждого статуса транзакции. Ключом является код статуса транзакции, а значением - количество транзакций в этом статусе.

```json
{
  "NEW": 5,
  "PENDING": 3,
  "COMPLETED": 12,
  "FAILED": 1,
  "DELETED": 2
}
```

### 10. Get Transaction Count By Bank (Получение количества транзакций по банкам)

Получение количества транзакций для каждого банка (отправителя и получателя).

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/count-by-bank`

#### Параметры запроса (Query Parameters)

*   Нет (Query parameters не требуются).

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                              |
|-----------------|----------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики по банкам. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, содержащий количество транзакций для каждого банка отправителя и получателя.

```json
{
  "senderBanks": {
    "Сбербанк": 10,
    "Тинькофф Банк": 5
  },
  "recipientBanks": {
    "Сбербанк": 7,
    "ВТБ": 3,
    "Тинькофф Банк": 5
  }
}
```

### 11. Get Amount By Category (Получение статистики по суммам транзакций по категориям)

Получение общей суммы транзакций для каждой категории для определенного типа транзакций (доход или расход).

*   **Метод:** `GET`
*   **URL:** `/api/transactions/stats/amount-by-category`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                                                     | Обязательный |
|------------|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|
| `typeCode` | `string` | **Обязательный**. Код типа транзакции, для которого необходимо получить статистику. Допустимые значения: `INCOME`, `EXPENSE`. Регистр не имеет значения. | Да           |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                             |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для получения статистики. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, где ключом является название категории, а значением - общая сумма транзакций в этой категории для указанного типа транзакций.

```json
{
  "Продукты": 500.00,
  "Транспорт": 250.00,
  "Развлечения": 100.00
}
```


## API Endpoints: Report Controller

Этот контроллер предоставляет эндпоинт для экспорта транзакций в файл Excel. Доступен только пользователям с ролью `USER`.

**Базовый URL:** `/api/reports`

### Аутентификация

Все запросы требуют аутентификации пользователя с ролью `USER`.  Необходимо передать Cookie `SESSIONID` в заголовке запроса.

### 1. Export Transactions to Excel (Экспорт транзакций в Excel)

Экспорт списка транзакций в файл Excel с возможностью фильтрации по различным параметрам.

*   **Метод:** `GET`
*   **URL:** `/api/reports/transactions/excel`

#### Параметры запроса (Query Parameters)

| Параметр           | Тип       | Описание                                                                                                                                  | Обязательный | Значение по умолчанию | Формат                        |
|--------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|-------------------------------|
| `senderBankId`     | `integer` | (Необязательный) ID банка отправителя.                                                                                                      | Нет          | N/A                     | Целое число                  |
| `recipientBankId`  | `integer` | (Необязательный) ID банка получателя.                                                                                                      | Нет          | N/A                     | Целое число                  |
| `startDate`        | `string`  | (Необязательный) Начальная дата периода транзакций.                                                                                          | Нет          | 1 месяц назад           | `yyyy-MM-ddTHH:mm:ss` (ISO 8601) |
| `endDate`          | `string`  | (Необязательный) Конечная дата периода транзакций.                                                                                           | Нет          | Текущая дата              | `yyyy-MM-ddTHH:mm:ss` (ISO 8601) |
| `statusId`         | `integer` | (Необязательный) ID статуса транзакции.                                                                                                    | Нет          | N/A                     | Целое число                  |
| `inn`              | `string`  | (Необязательный) ИНН получателя.                                                                                                           | Нет          | N/A                     | Строка                       |
| `minAmount`        | `number`  | (Необязательный) Минимальная сумма транзакции.                                                                                                | Нет          | N/A                     | Число с плавающей точкой    |
| `maxAmount`        | `number`  | (Необязательный) Максимальная сумма транзакции.                                                                                                | Нет          | N/A                     | Число с плавающей точкой    |
| `transactionTypeId`| `integer` | (Необязательный) ID типа транзакции.                                                                                                       | Нет          | N/A                     | Целое число                  |
| `categoryId`       | `integer` | (Необязательный) ID категории транзакции.                                                                                                    | Нет          | N/A                     | Целое число                  |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                             |
|-----------------|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для экспорта транзакций. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
*   **Content-Disposition:** `attachment; filename="transactions_YYYYMMDD_HHmmss.xlsx"`

Сервер возвращает файл Excel в бинарном виде.  Имя файла генерируется автоматически и включает текущую дату и время.

#### Ошибочные ответы (Error Responses)

*   **`400 Bad Request`**: Возвращается, если какой-либо из параметров запроса указан неверно.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Неверный формат даты. Используйте yyyy-MM-ddTHH:mm:ss.
        ```

*   **`401 Unauthorized`**: Возвращается, если отсутствует или недействителен Cookie `SESSIONID`.

    *   **Content-Type:** `application/json` (или `text/plain`)
    *   **Пример тела ответа:**

        ```json
        {
          "error": "Пользователь не авторизован"
        }
        ```

*   **`500 Internal Server Error`**: Возвращается при возникновении внутренней ошибки на сервере, например, если не удалось сгенерировать файл Excel.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Ошибка при формировании файла Excel
        ```

#### Замечания

*   **Обязательно наличие Cookie `SESSIONID` в заголовке запроса.**
*   Формат даты должен соответствовать ISO 8601 (`yyyy-MM-ddTHH:mm:ss`). Например, `2024-10-28T10:00:00`.
*   Имя файла Excel генерируется автоматически на сервере.
*   Если не указаны параметры `startDate` и `endDate`, будет экспортирован список транзакций за последний месяц.
*   Возвращаемый файл имеет MIME-тип `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.

### 2. Export Category Report to Excel (Экспорт отчета по категориям в Excel)

Экспорт отчета по категориям (с суммами транзакций) в файл Excel для указанного типа транзакций (доходы или расходы).

*   **Метод:** `GET`
*   **URL:** `/api/reports/categories/excel`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                                              | Обязательный |
|------------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|
| `typeCode` | `string` | **Обязательный**. Код типа транзакций, для которого необходимо сгенерировать отчет. Допустимые значения: `INCOME`, `EXPENSE`. Регистр не имеет значения. | Да           |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                       |
|-----------------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для экспорта отчета. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
*   **Content-Disposition:** `attachment; filename="categories_[income/expense]_YYYYMMDD_HHmmss.xlsx"`

Сервер возвращает файл Excel в бинарном виде. Имя файла генерируется автоматически и включает тип отчета ("income" или "expense"), текущую дату и время.

#### Ошибочные ответы (Error Responses)

*   **`400 Bad Request`**: Возвращается, если не указан параметр `typeCode` или указано некорректное значение.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Required request parameter 'typeCode' for method parameter type String is not present
        ```

*   **`401 Unauthorized`**: Возвращается, если отсутствует или недействителен Cookie `SESSIONID`.

    *   **Content-Type:** `application/json` (или `text/plain`)
    *   **Пример тела ответа:**

        ```json
        {
          "error": "Пользователь не авторизован"
        }
        ```

*   **`500 Internal Server Error`**: Возвращается при возникновении внутренней ошибки на сервере, например, если не удалось сгенерировать файл Excel.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Ошибка при формировании Excel отчета по категориям
        ```

#### Замечания

*   **Обязательно наличие Cookie `SESSIONID` в заголовке запроса.**
*   Допустимые значения параметра `typeCode`: `INCOME`, `EXPENSE`. Регистр не имеет значения.
*   Имя файла Excel генерируется автоматически на сервере и включает тип отчета (`income` или `expense`), текущую дату и время.
*   Возвращаемый файл имеет MIME-тип `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.

### 3. Export Dashboard Report to Excel (Экспорт сводного отчета в Excel)

Экспорт сводного отчета (дашборда) в файл Excel, содержащего основные финансовые показатели за указанный период.

*   **Метод:** `GET`
*   **URL:** `/api/reports/dashboard/excel`

#### Параметры запроса (Query Parameters)

| Параметр   | Тип      | Описание                                                                                                                                      | Обязательный | Значение по умолчанию | Формат                       |
|------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------|--------------|-------------------------|------------------------------|
| `startDate` | `string` | (Необязательный) Начальная дата периода, за который необходимо сгенерировать отчет.                                                            | Нет          | 1 год назад             | `yyyy-MM-ddTHH:mm:ss` (ISO 8601) |
| `endDate`   | `string` | (Необязательный) Конечная дата периода, за который необходимо сгенерировать отчет.                                                             | Нет          | Текущая дата              | `yyyy-MM-ddTHH:mm:ss` (ISO 8601) |

#### Заголовки (Headers)

| Заголовок      | Значение                   | Описание                                                                                                                   |
|-----------------|----------------------------|---------------------------------------------------------------------------------------------------------------------------|
| `Cookie`        | `SESSIONID=<сессионный_id>` | **Обязательный**. Содержит идентификатор сессии пользователя для аутентификации и авторизации. Необходим для экспорта отчета. |

#### Тело запроса (Request Body)

*   Тело запроса не требуется.

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
*   **Content-Disposition:** `attachment; filename="financial_dashboard_YYYYMMDD_HHmmss.xlsx"`

Сервер возвращает файл Excel в бинарном виде. Имя файла генерируется автоматически и включает текущую дату и время.

#### Ошибочные ответы (Error Responses)

*   **`400 Bad Request`**: Возвращается, если указан неверный формат даты.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Неверный формат даты. Используйте yyyy-MM-ddTHH:mm:ss
        ```

*   **`401 Unauthorized`**: Возвращается, если отсутствует или недействителен Cookie `SESSIONID`.

    *   **Content-Type:** `application/json` (или `text/plain`)
    *   **Пример тела ответа:**

        ```json
        {
          "error": "Пользователь не авторизован"
        }
        ```

*   **`500 Internal Server Error`**: Возвращается при возникновении внутренней ошибки на сервере, например, если не удалось сгенерировать файл Excel.

    *   **Content-Type:** `text/plain`
    *   **Пример тела ответа:**

        ```text
        Ошибка при формировании сводного Excel отчета
        ```

#### Замечания

*   **Обязательно наличие Cookie `SESSIONID` в заголовке запроса.**
*   Формат даты должен соответствовать ISO 8601 (`yyyy-MM-ddTHH:mm:ss`). Например, `2024-10-28T10:00:00`.
*   Если параметры `startDate` и `endDate` не указаны, будет сгенерирован отчет за последний год.
*   Имя файла Excel генерируется автоматически на сервере и включает текущую дату и время.






