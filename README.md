## Система финансового мониторинга и отчетности

### Быстрый старт
1. Создайте директорию проекта, например, `personal-finance`
2. Перейдите в директорию проекта в консоли и скопируйте репозиторий проекта в директорию проекта: выполните команду `git clone git@github.com:borisey/financial-monitoring-and-reporting ./`
3. Установите зависимости `Maven`. В консоли (в корневой директории проекта) выполните команду `mvn clean install`
4. Установите `MySQL` в `Docker-контейнере`: в консоли (в корневой директории проекта) выполните команду `docker-compose up`
5. Запустите приложение в IDE IDEA: откройте файл `/src/main/java/com/borisey/personal_finance/PersonalFinanceApplication.java` и выполните команду `RUN`
6. Откройте приложение в браузере `http://localhost:8080`
7. Зарегистрируйтесь в приложении (по ссылке: `http://localhost:8080/register`)
8. Авторизуйтесь в приложении, используя логин и пароль, указанные при регистрации
9. Создайте `категорию дохода`
10. Создайте `категорию расхода`
12. Добавьте `транзакции` 
13. Сформируйте отчеты

### Описание приложения
1. Реализация авторизации пользователей
2. Взаимодействие с пользователем
3. Управление доходами и расходами
4. Вывод информации
5. Сохранение и загрузка данных
6. Валидация данных
7. Дополнительные возможности
8. Генерация отчетов
9. Вывод аналитики по разным параметрам
10. Разделение функционала по классам


## Итоговые артефакты демонстрации реализованного решения

## Реализованное веб-приложение

Приложение реализовано


## Демонстрация работы с входными данными

https://drive.google.com/file/d/1ZWWb_chqjkZ3K1CxNxZI6V2guAqh2zhq/view


## Отчеты о прохождении тестирования

https://drive.google.com/file/d/1ZWWb_chqjkZ3K1CxNxZI6V2guAqh2zhq/view


## Архитектура

Многослойная архитектура (n-tier architecture) основанная на принципах Model-View-Controller (MVC) с элементами REST

![image](https://github.com/user-attachments/assets/0134b001-832d-4790-9888-03ca6d913055)

### Слои приложения

#### 1 Уровень представления (Presentation Layer)
Контроллеры `com.borisey.personal_finance.controllers`:
Обрабатывают HTTP-запросы
REST API эндпоинты для взаимодействия с фронтендом
Контроллеры: `BankController`, `CategoryController`, `ReferenceDataController`, `ReportController`, `TransactionController`

#### 2 Уровень бизнес-логики (Business Layer)
Сервисы `com.borisey.personal_finance.services`:
Реализуют бизнес-логику приложения
Обрабатывают данные, полученные от контроллеров
Взаимодействуют с репозиториями для получения/сохранения данных
`UserService` для аутентификации и управления пользователями

#### 3 Уровень доступа к данным (Data Access Layer)
Репозитории `com.borisey.personal_finance.repo`:
Интерфейсы, расширяющие Spring Data JPA для доступа к базе данных
Репозитории: `UserRepository`, `BankRepository`, `CategoryRepository`, `PersonTypeRepository`, `TransactionRepository`, `TransactionStatusRepository`, `TransactionTypeRepository`
Спецификации `com.borisey.personal_finance.specifications`:
Реализуют гибкую фильтрацию данных в запросах к БД

#### 4 Уровень данных (Data Layer)
Модели `com.borisey.personal_finance.models`:
Сущности JPA: `Bank`, `Category`, `PersonType`, `Transaction`, `TransactionStatus`, `TransactionType`, `User`
Соответствуют таблицам базы данных
Содержат связи между сущностями
Аннотированы для корректного ORM-мапинга

#### 5 Конфигурация и безопасность
Конфигурационные классы `com.borisey.personal_finance.config`:
`WebSecurityConfig` для настройки аутентификации и авторизации
Настройка CORS для взаимодействия с фронтендом

### Диаграмма компонентов системы

![image](https://github.com/user-attachments/assets/6b2433ff-d6fa-4506-b0b3-bfbd0ddc5df4)

### Технологический стек

#### Backend:
Java 23
Spring Boot 3.3.5
Spring Security (аутентификация/авторизация)
Spring Data JPA (доступ к данным)
Hibernate (ORM)

#### Хранение данных:
MySQL (база данных)
Hibernate Validator (валидация данных)

#### Дополнительные библиотеки:
Lombok (уменьшение шаблонного кода)
Apache POI (работа с Excel файлами для отчетов)
Joda Time (работа с датами)
Apache Commons Lang (утилиты)

#### Инфраструктура:
Docker (контейнеризация)
Maven (сборка проекта)


## Диаграммы (бд, пользовательские)

![image](https://github.com/user-attachments/assets/68ded25f-84e8-4e5f-81f7-f3e3802c911a)

## Техническая документация

Все пути начинаются с `auth/` для общения с сервером после логина необходимо добовлять Cookie `SESSIONID` к каждому запросу.  

## API Endpoints: Authentication Controller

Этот контроллер предоставляет endpoints для аутентификации пользователей (вход, регистрация, выход).

### 1. Login (Вход)

*   **Method:** `POST`
*   **URL:** `/api/auth/login`
*   **Description:** Аутентификация существующего пользователя.

#### Заголовки 

*   `Content-Type`: `application/json` 

#### Тело запроса 

```json
{
  "username": "user123",  
  "password": "password123" 
}
```

### 2. register (Регистрация)

*   **Method:** `POST`
*   **URL:** `/api/auth/register`
*   **Description:** Регистрация нового пользователя.

#### Заголовки 

*   `Content-Type`: `application/json` 

#### Тело запроса 

```json
{
  "username": "user123",  // Замените на имя пользователя
  "password": "password123" // Замените на пароль
}
```

### 3. register (Logout)

*   **Method:** `POST`
*   **URL:** `/api/auth/logout`
*   **Description:** Выход.

#### Заголовки (Headers)

*   `Content-Type`: `application/json` 

## 4. Get Current User (Получение информации о текущем пользователе)

Получение информации о текущем аутентифицированном пользователе.

*   **Метод:** `GET`
*   **URL:** `/api/auth/user`

### Заголовки 

`Content-Type`: `application/json` 

### Тело запроса 

*   Тело запроса не требуется.


## API Endpoints: Category Controller

Этот контроллер предоставляет endpoints для управления категориями транзакций. Доступен только пользователям с ролью 'USER'.

**Базовый URL:** `/api/categories`

### Аутентификация

Все endpoints требуют аутентификации пользователя с ролью `USER`. Это можно сделать через активную сессию.

### 1. Get All Categories (Получение всех категорий)

Получение списка всех категорий, принадлежащих текущему пользователю.

*   **Метод:** `GET`
*   **URL:** `/api/categories`

### Заголовки 

`Content-Type`: `application/json` 

#### Параметры запроса (Query Parameters)

| `transactionTypeId` | `integer` | (Опционально) ID типа транзакции, для фильтрации категорий по типу транзакции.                                   
| `sortBy`            | `string`  | (Опционально) Поле, по которому нужно отсортировать категории.                                                     

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

```json
[
  {
    "id": 1,
    "title": "Продукты",
    "transactionTypeId": 1,
    "userId": 1
  },
  {
    "id": 2,
    "title": "Транспорт",
    "transactionTypeId": 2,
    "userId": 1
  }
]
```

### 2. Get Category By ID (Получение категории по ID)

Получение информации о конкретной категории по её уникальному идентификатору.

*   **Метод:** `GET`
*   **URL:** `/api/categories/{id}`

#### Параметры URL (Path Parameters)


 `id` | `integer` | **Обязательный**. Уникальный идентификатор категории, информацию о которой необходимо получить.  Значение должно быть целым числом, представляющим существующую категорию, принадлежащую текущему пользователю. 

#### Заголовки (Headers)

`Content-Type`: `application/json` 

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает объект категории в формате JSON.

```json
{
  "id": 123,
  "title": "Еда",
  "transactionTypeId": 456,
  "userId": 789
}
```

### 3. Get Categories With Totals (Получение категорий с суммами транзакций)

Получение списка категорий с общей суммой транзакций за указанный период времени для определенного типа транзакций.

*   **Метод:** `GET`
*   **URL:** `/api/categories/with-totals`

#### Заголовки (Headers)

`Content-Type`: `application/json` 

#### Параметры запроса (Query Parameters)

| Параметр        | Тип         | Описание                                                                                                                                                                                                                                                                                                                             | Обязательный | Значение по умолчанию | Формат                                 |
|-----------------|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|-----------------------|----------------------------------------|
| `transactionTypeId` | `integer`   | **Обязательный**. Идентификатор типа транзакции, для которого нужно получить итоги по категориям.                                                                                                                                                                                                                                           | Да           | N/A                     | Целое число                              |
| `startDate`     | `string`    | (Необязательный) Начальная дата периода, за который нужно получить итоги.                                                                                                                                                                                                                                                                | Нет          | 1 месяц назад от текущей даты (включительно) | `dd.MM.yyyy` (например, `01.01.2023`) |
| `endDate`       | `string`    | (Необязательный) Конечная дата периода, за который нужно получить итоги.                                                                                                                                                                                                                                                                 | Нет          | Текущая дата (включительно)                | `dd.MM.yyyy` (например, `31.12.2023`) |
| `sortBy`        | `string`    | (Необязательный)  Поле, по которому нужно отсортировать категории.                                                                                                                                                                                                                                                                       | Нет          | `title`                | Строка (например, `title`)              |

#### Успешный ответ (Success Response)

*   **Код:** `200 OK`
*   **Content-Type:** `application/json`

При успешном выполнении запроса сервер возвращает JSON-объект, где ключи - это названия категорий, а значения - общие суммы транзакций для каждой категории за указанный период и для указанного типа транзакций.

```json
{
  "Продукты": 1250.50,
  "Транспорт": 300.00,
  "Развлечения": 500.00
}
```


